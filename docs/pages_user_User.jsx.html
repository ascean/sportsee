<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/user/User.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/user/User.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from "react";
import UserInfos from "../../components/userInfos/UserInfos";
import VerticalBar from "../../components/verticalBar/VerticalBar";
import { FormattedKeyDataModel } from "../../models/formattedKeyDataModel";
import { UserActivityModel } from "../../models/userActivityModel";
import { UserMainDataModel } from "../../models/userMainDataModel";
import { UserAverageSessionModel } from "../../models/userAverageSessionModel";
import {
    getUserInfos,
    getUserActivity,
    getUserSession,
    getUserPerformance,
} from "../../services/services";
import KeyData from "../../components/keyData/KeyData";
import { UserPerformanceModel } from "../../models/userPerformanceModel";
import ObjectifGraph from "../../components/objectif/ObjectifGraph";
import PerformanceGraph from "../../components/performance/PerformanceGraph";
import SessionGraph from "../../components/session/SessionGraph";
import ActivityGraph from "../../components/activity/ActivityGraph";

/**
 * Render the main page (profil page)
 * @returns {ReactElement}
 */
const User = () => {
    const [isLoadingUser, setIsLoadingUser] = useState(true);
    const [isLoadingActivity, setIsLoadingActivity] = useState(true);
    const [isLoadingSession, setIsLoadingSession] = useState(true);
    const [isLoadingPerformance, setIsLoadingPerformance] = useState(true);
    const [userMainDatas, setUserMainDatas] = useState(null);
    const [activityDatas, setActivityDatas] = useState(null);
    const [sessionDatas, setSessionDatas] = useState(null);
    const [performanceDatas, setPerformanceDatas] = useState(null);
    const [caloryDatas, setCaloryDatas] = useState(null);
    const [proteinDatas, setProteinDatas] = useState(null);
    const [glucidDatas, setGlucidDatas] = useState(null);
    const [lipidDatas, setLipidDatas] = useState(null);

    useEffect(() => {
        //URL datas gestion
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        //12 = default value if no user_id in URL 
        let value = params.user_id ?? 12;

        getMainData(value);
        getActivityData(value);
        getSessionData(value);
        getPerformanceData(value);
    }, []);

    /**
     * get datas from API / USER_MAIN_DATA
     * @param {integer} userId User code
     */
    const getMainData = async (userId) => {
        const dataFromFetch = await getUserInfos(userId);
        const data = new UserMainDataModel(dataFromFetch);
        setUserMainDatas(data);
        setIsLoadingUser(false);
        formatKeyData(data.keyData);
    };

    /**
     * get datas from API / USER_ACTIVITY
     * @param {integer} userId User code
     */
    const getActivityData = async (userId) => {
        const dataFromFetch = await getUserActivity(userId);
        const data = new UserActivityModel(dataFromFetch);
        setActivityDatas(data.sessions);
        setIsLoadingActivity(false);
    };

    /**
     * get datas from API / USER_AVERAGE_SESSIONS
     * @param {integer} userId User code
     */
    const getSessionData = async (userId) => {
        const dataFromFetch = await getUserSession(userId);
        const data = new UserAverageSessionModel(dataFromFetch);
        setSessionDatas(data.sessions);
        setIsLoadingSession(false);
    };

    /**
     * get datas from APi - USER_PERFORMANCE
     * @param {integer} userId User code
     */
    const getPerformanceData = async (userId) => {
        const dataFromFetch = await getUserPerformance(userId);
        const data = new UserPerformanceModel(dataFromFetch);
        setPerformanceDatas(data);
        setIsLoadingPerformance(false);
    };

    /**
     * Format USER_MAIN_DATA.keyData datas (calory, protein...) in order to display
     * @param {Object} data USER_MAIN_DATAS.keyData
     * @param {string} data.key 
     * @param {string} data.label 
     * @param {string} data.unit
     * @param {string} data.img 
     * @param {number} data.count 
     * @param {string} data.classIcon 
     */
    const formatKeyData = (data) => {
        setCaloryDatas(
            new FormattedKeyDataModel(
                "calorie",
                "Calories",
                "kCal",
                `/icons/calorie.png`,
                data.calorieCount,
                "calorie-icon"
            )
        );
        setProteinDatas(
            new FormattedKeyDataModel(
                "protein",
                "Protéines",
                "g",
                `/icons/protein.png`,
                data.proteinCount,
                "protein-icon"
            )
        );
        setGlucidDatas(
            new FormattedKeyDataModel(
                "carbohydrate",
                "Glucides",
                "g",
                `/icons/carbohydrate.png`,
                data.carbohydrateCount,
                "glucid-icon"
            )
        );
        setLipidDatas(
            new FormattedKeyDataModel(
                "lipid",
                "Lipides",
                "g",
                `/icons/lipid.png`,
                data.lipidCount,
                "lipid-icon"
            )
        );
    };

    return (
        &lt;main>
            &lt;VerticalBar />
            &lt;div className="main-content">
                {isLoadingUser ? (
                    "Loading"
                ) : (
                    &lt;UserInfos firstName={userMainDatas.userInfos.firstName} />
                )}

                &lt;section className="recharts-container">
                    &lt;article className="left-container">
                        &lt;div className="activity-container">
                            {isLoadingActivity ? (
                                "Loading"
                            ) : (
                                &lt;ActivityGraph activityDatas={activityDatas} />
                            )}
                        &lt;/div>
                        &lt;div className="bottom-container">
                            &lt;div className="line-container">
                                {isLoadingSession ? (
                                    "Loading"
                                ) : (
                                    &lt;SessionGraph sessionDatas={sessionDatas} />
                                )}
                            &lt;/div>
                            &lt;div className="radar-container">
                                {isLoadingPerformance ? (
                                    "Loading"
                                ) : (
                                    &lt;PerformanceGraph
                                        performanceDatas={performanceDatas}
                                    />
                                )}
                            &lt;/div>
                            &lt;div className="radial-container">
                                {isLoadingUser ? (
                                    "Loading"
                                ) : (
                                    &lt;ObjectifGraph
                                        todayScore={userMainDatas.todayScore}
                                    />
                                )}
                            &lt;/div>
                        &lt;/div>
                    &lt;/article>
                    &lt;article className="right-container">
                        &lt;div className="keydata-container">
                            {isLoadingUser ? (
                                "Loading"
                            ) : (
                                &lt;KeyData datas={caloryDatas} />
                            )}
                            {isLoadingUser ? (
                                "Loading"
                            ) : (
                                &lt;KeyData datas={proteinDatas} />
                            )}
                            {isLoadingUser ? (
                                "Loading"
                            ) : (
                                &lt;KeyData datas={glucidDatas} />
                            )}
                            {isLoadingUser ? (
                                "Loading"
                            ) : (
                                &lt;KeyData datas={lipidDatas} />
                            )}
                        &lt;/div>
                    &lt;/article>
                &lt;/section>
            &lt;/div>
        &lt;/main>
    );
};

export default User;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ActivityModel_ActivityModel.html">ActivityModel</a></li><li><a href="Button.html">Button</a></li><li><a href="FormattedKeyDataModel_FormattedKeyDataModel.html">FormattedKeyDataModel</a></li><li><a href="KeyDataModel_KeyDataModel.html">KeyDataModel</a></li><li><a href="PerformanceDataModel_PerformanceDataModel.html">PerformanceDataModel</a></li><li><a href="SessionModel_SessionModel.html">SessionModel</a></li><li><a href="UserActivityModel_UserActivityModel.html">UserActivityModel</a></li><li><a href="UserAverageSessionModel_UserAverageSessionModel.html">UserAverageSessionModel</a></li><li><a href="UserInfosModel_UserInfosModel.html">UserInfosModel</a></li><li><a href="UserMainDataModel_UserMainDataModel.html">UserMainDataModel</a></li><li><a href="UserPerformanceModel_UserPerformanceModel.html">UserPerformanceModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ActivityGraph">ActivityGraph</a></li><li><a href="global.html#Error">Error</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#KeyData">KeyData</a></li><li><a href="global.html#ObjectifGraph">ObjectifGraph</a></li><li><a href="global.html#PerformanceGraph">PerformanceGraph</a></li><li><a href="global.html#SessionGraph">SessionGraph</a></li><li><a href="global.html#User">User</a></li><li><a href="global.html#UserInfos">UserInfos</a></li><li><a href="global.html#VerticalBar">VerticalBar</a></li><li><a href="global.html#VerticalButton">VerticalButton</a></li><li><a href="global.html#getUserActivity">getUserActivity</a></li><li><a href="global.html#getUserInfos">getUserInfos</a></li><li><a href="global.html#getUserPerformance">getUserPerformance</a></li><li><a href="global.html#getUserSession">getUserSession</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Mon Nov 14 2022 09:19:40 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
